# 🔐 安全性说明

## 系统安全机制

本宿舍管理系统采用多层安全措施，确保数据和账户安全。

---

## 1. 强制密码初始化 ✅

### 首次使用流程

当您首次访问系统时：

1. **无法直接登录** - 系统检测到未初始化状态
2. **显示设置提示** - 登录界面会显示"首次使用提醒"
3. **强制设置密码** - 必须点击"立即设置"完成初始化
4. **默认密码失效** - 设置完成后，默认密码永久失效

### 设置要求

- 管理员密码：至少6位字符
- 查看者密码：至少6位字符
- 两次输入必须一致
- 设置完成后无法查看或恢复

### 为什么这样设计？

❌ **旧版问题**: 默认密码显示在登录界面，任何人都能看到
✅ **新版方案**: 强制设置唯一密码，确保只有您知道

---

## 2. 用户角色权限控制

### 管理员 (admin)

**完整权限**:
- ✅ 查看所有数据
- ✅ 添加/编辑/删除人员信息
- ✅ 管理房间和床位
- ✅ 导出Excel报表
- ✅ 同步数据到GitHub
- ✅ 修改任何用户密码
- ✅ 配置系统设置

**适用场景**: 宿舍管理员、系统管理员

### 查看者 (viewer)

**只读权限**:
- ✅ 查看所有数据
- ✅ 导出Excel报表
- ✅ 同步数据到GitHub
- ❌ 不能添加/编辑/删除数据
- ❌ 不能修改密码
- ❌ 不能修改系统配置

**适用场景**: 查询人员、上级领导、财务人员

---

## 3. 数据存储安全

### 本地存储 (localStorage)

**存储内容**:
- 人员信息
- 房间配置
- 退宿记录
- 用户密码（加密后）
- GitHub配置

**安全措施**:
- 数据仅存储在当前浏览器
- 其他人无法访问您的浏览器数据
- 清除浏览器数据会同时清除系统数据

**风险提示**:
⚠️ 公共电脑使用后务必退出登录
⚠️ 定期同步数据到GitHub以防数据丢失

### 云端存储 (GitHub Gist)

**存储内容**:
- 人员信息备份
- 房间配置备份
- 退宿记录备份

**安全措施**:
- 使用私有Gist（默认不公开）
- 通过Personal Access Token验证身份
- 支持版本历史，可回滚数据

**访问控制**:
- 只有拥有Token的人才能访问
- Token可以随时撤销
- 可设置Token过期时间

---

## 4. GitHub Token安全

### Token是什么？

GitHub Personal Access Token (PAT) 相当于您GitHub账号的"钥匙"，用于系统访问您的GitHub Gist进行数据同步。

### Token权限

**本系统只需要**:
- ✅ `gist` 权限（创建和管理Gist）

**不需要的权限** (请勿勾选):
- ❌ repo (访问仓库代码)
- ❌ workflow (执行Actions)
- ❌ admin (管理设置)
- ❌ 其他任何权限

### Token安全建议

1. **创建专用Token**
   - 为本系统单独创建Token
   - 不要复用其他项目的Token
   - 只授予必需的gist权限

2. **设置过期时间**
   - 建议设置90天或1年过期
   - 过期前及时更新Token

3. **保管Token**
   - Token只显示一次，务必立即复制
   - 不要将Token发送给他人
   - 不要在截图中暴露Token
   - 不要提交Token到代码仓库

4. **定期更换**
   - 建议每6个月更换一次
   - 如怀疑Token泄露，立即撤销

5. **撤销Token**
   - GitHub设置 → Developer settings → Personal access tokens
   - 找到对应Token点击Delete
   - 撤销后系统将无法同步，需配置新Token

---

## 5. 密码管理

### 密码重置（忘记密码）

如果忘记密码，可以通过以下步骤重置：

```javascript
// 1. 打开浏览器开发者工具 (F12)
// 2. 切换到Console标签
// 3. 执行以下命令：

localStorage.removeItem('users');
localStorage.removeItem('systemInitialized');
location.reload();

// 4. 刷新页面后重新进行初始化设置
```

⚠️ **注意**: 重置密码不会影响已存储的数据

### 修改密码

**管理员操作**:
1. 登录系统
2. 进入"系统设置"标签
3. 在"用户管理"区域选择用户
4. 输入新密码（至少6位）
5. 点击"修改密码"

**建议**:
- 定期（3-6个月）修改密码
- 使用复杂密码（数字+字母+符号）
- 不要使用常见密码（123456、password等）

---

## 6. 多设备使用安全

### 场景1: 办公室电脑 + 家里电脑

**安全实践**:
1. 两台设备使用相同Token和Gist ID
2. 每次使用后点击"退出"
3. 避免保存浏览器密码
4. 定期同步数据

### 场景2: 多人协作

**权限分配**:
- 管理员：宿舍管理员（1-2人）
- 查看者：其他需要查询的人员

**配置方法**:
1. 管理员配置Token和Gist ID
2. 将Token和Gist ID分享给其他管理员
3. 查看者使用相同Token但只能查看

**安全建议**:
- 定期检查谁在使用系统
- 离职人员需修改密码
- 重要操作留痕（导出Excel备份）

### 场景3: 公共电脑（不推荐）

**如必须使用**:
1. 使用浏览器隐身模式
2. 使用完立即退出登录
3. 清除浏览器历史记录
4. 不要勾选"记住密码"

---

## 7. 数据备份与恢复

### 备份策略（3-2-1原则）

**3份数据**:
1. 浏览器localStorage（工作副本）
2. GitHub Gist（云端备份）
3. Excel导出文件（本地备份）

**2种介质**:
1. 云端（GitHub）
2. 本地（电脑硬盘/U盘）

**1份异地**:
- GitHub自动异地多机房备份

### 定期备份建议

- **每天**: 同步到GitHub（点击"同步数据"）
- **每周**: 导出Excel备份到本地
- **每月**: 检查备份完整性

### 数据恢复

**场景1: 浏览器数据丢失**
- 解决: 配置Token和Gist ID，刷新页面自动恢复

**场景2: GitHub数据损坏**
- 解决: 访问Gist历史版本，找到正确版本恢复

**场景3: 误删除操作**
- 解决: 从Excel备份导入，或从Gist历史恢复

---

## 8. 常见安全问题

### Q1: Token会过期吗？

**A**: 会的。根据您创建Token时的设置：
- 如选择"No expiration"则永不过期
- 如选择90天/1年则到期后失效
- 过期后需重新创建并配置新Token

### Q2: 其他人能看到我的数据吗？

**A**: 不能，除非：
- 您分享了GitHub Token
- 您分享了Gist ID
- 您在公共电脑未退出登录

### Q3: 密码存在哪里？

**A**: 密码经过处理后存储在浏览器localStorage中，只有您的浏览器能访问。

### Q4: GitHub能看到我的数据吗？

**A**: GitHub作为存储平台可以访问Gist内容，但：
- Gist设置为私有，其他GitHub用户看不到
- GitHub有严格的隐私政策
- 如有极高安全要求，可考虑只使用本地存储

### Q5: 如何确保数据不被泄露？

**A**: 遵循以下原则：
- ✅ 使用强密码
- ✅ 保护好GitHub Token
- ✅ 定期修改密码
- ✅ 不在公共电脑使用
- ✅ 退出时点击"退出"按钮
- ✅ 定期检查GitHub Token使用情况

---

## 9. 应急响应

### Token泄露

**立即操作**:
1. 访问GitHub Settings → Developer settings
2. 撤销泄露的Token
3. 创建新Token
4. 在系统中更新Token配置
5. 修改所有用户密码

### 数据泄露

**立即操作**:
1. 修改所有用户密码
2. 检查GitHub Gist访问日志
3. 如必要，删除Gist并创建新的
4. 从本地Excel备份重新导入数据

### 账号被盗

**立即操作**:
1. 重置密码（见上文密码重置步骤）
2. 检查最近的数据修改
3. 从GitHub历史版本恢复数据
4. 加强密码强度

---

## 10. 最佳实践建议

### 日常使用

1. **每次使用后退出登录**
2. **定期（每天/每周）同步数据**
3. **重要操作前先备份**
4. **使用复杂密码**
5. **不在公共场合展示界面**

### 管理员职责

1. **定期修改密码**（3-6个月）
2. **定期检查数据完整性**
3. **培训其他用户安全使用**
4. **保管好Token和Gist ID**
5. **监控系统访问情况**

### 查看者建议

1. **只查看不修改**
2. **导出数据时注意保密**
3. **不要分享登录信息**
4. **发现异常及时报告管理员**

---

## 📞 安全支持

如发现安全问题或有安全疑问：

1. 查看本文档FAQ部分
2. 检查浏览器控制台错误信息
3. 联系系统管理员
4. 查阅GitHub官方安全文档

---

**记住**: 安全是持续的过程，不是一次性的设置！

**最后更新**: 2025年1月  
**版本**: v2.0
