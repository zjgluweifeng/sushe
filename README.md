# 宿舍管理系统 - GitHub版本

## 🎯 新增功能

### 1. 用户角色管理
- **管理员 (admin)**: 可以添加、编辑、删除人员和房间信息
- **查看者 (viewer)**: 只能查看数据，不能修改

### 2. GitHub数据同步
- 使用GitHub Gist作为云端数据库
- 自动同步数据到云端
- 支持多设备数据共享
- 无需配置服务器

## 📝 快速开始

### 步骤1: 部署到GitHub Pages

1. 在GitHub上创建新仓库（例如：`dormitory-system`）
2. 将 `index-enhanced.html` 重命名为 `index.html`
3. 上传到仓库
4. 在仓库设置中启用GitHub Pages
5. 访问：`https://your-username.github.io/dormitory-system/`

### 步骤2: 配置GitHub Token

1. 访问 GitHub 设置页面
   - 点击右上角头像 → Settings
   - 左侧菜单找到 "Developer settings"
   - 选择 "Personal access tokens" → "Tokens (classic)"
   - 点击 "Generate new token (classic)"

2. 配置Token权限
   - Note: 填写 `Dormitory System Sync`
   - Expiration: 建议选择 `No expiration`
   - 勾选权限：**gist** (创建和管理Gist)
   - 点击 "Generate token"

3. **重要**: 立即复制生成的Token（只显示一次）

### 步骤3: 首次登录并设置密码

1. **首次访问系统**会提示进行初始化设置

2. 点击"立即设置"按钮

3. 为管理员和查看者设置安全密码：
   ```
   管理员用户名: admin (固定)
   查看者用户名: viewer (固定)
   
   请设置自己的安全密码（至少6位）
   ```

4. 完成设置后，使用新密码登录

**重要**: 设置完成后，默认密码将失效，系统不会再显示任何默认密码提示

### 步骤4: 配置GitHub同步

1. 登录后进入"系统设置"标签页

2. 粘贴您的GitHub Token

3. 点击"保存配置"

4. 点击"测试连接"确认配置成功

### 步骤5: 开始使用

1. **添加房间**: 先在"房间管理"中添加宿舍楼栋和房间
2. **登记人员**: 在"人员登记"中添加住宿人员
3. **同步数据**: 点击右上角"同步数据"按钮备份到GitHub

## 🔧 配置说明

### GitHub Token安全性

- Token存储在浏览器localStorage中（仅本地存储）
- 不会发送到除GitHub API外的任何服务器
- 建议定期更换Token
- 不要将Token分享给他人

### Gist ID

- 首次同步时会自动创建私有Gist
- Gist ID会自动保存，无需手动输入
- 如需使用现有Gist，可手动输入Gist ID

### 数据存储逻辑

```
浏览器 localStorage ←→ GitHub Gist
         ↓
    实时缓存           云端备份
    (离线可用)         (多设备同步)
```

## 🔒 安全机制

### 首次使用强制设置密码

- 系统检测到首次使用时，会强制要求设置密码
- 设置完成前无法登录系统
- 设置完成后，默认密码失效且不再显示

### 密码重置

如果忘记密码，可以通过以下方式重置：

1. 打开浏览器开发者工具（按F12）
2. 切换到Console标签
3. 执行以下命令：
   ```javascript
   localStorage.removeItem('users');
   localStorage.removeItem('systemInitialized');
   location.reload();
   ```
4. 刷新页面后重新进行初始化设置

⚠️ **注意**: 重置密码不会影响已存储的数据（人员、房间等信息）

## 👥 用户管理

### 修改密码

管理员可以随时修改任何用户的密码：

1. 管理员登录后进入"系统设置"
2. 在"用户管理"区域选择要修改的用户
3. 输入新密码（至少6位）
4. 点击"修改密码"

### 用户角色说明

系统预设两个固定用户：
- **admin**: 管理员角色，可以管理所有数据和用户
- **viewer**: 查看者角色，只能查看和导出数据

用户名固定不可修改，但密码可以随时更改。

## 📊 数据同步

### 自动同步

- 每次操作后，数据自动保存到localStorage
- 点击"同步数据"按钮手动同步到GitHub

### 同步状态指示

- 🟢 绿色: 已同步
- 🟠 橙色: 正在同步
- 🔴 红色: 同步失败

### 多设备使用

1. **设备A**: 配置Token和Gist ID → 同步数据
2. **设备B**: 输入**相同的Token和Gist ID** → 数据自动从云端加载
3. 两台设备都可以读写数据（注意避免同时编辑）

## 🔒 权限控制

| 功能 | 管理员 | 查看者 |
|------|--------|--------|
| 查看所有数据 | ✅ | ✅ |
| 添加人员 | ✅ | ❌ |
| 编辑人员 | ✅ | ❌ |
| 删除人员 | ✅ | ❌ |
| 管理房间 | ✅ | ❌ |
| 导出Excel | ✅ | ✅ |
| 同步数据 | ✅ | ✅ |
| 修改密码 | ✅ | ❌ |

## 📱 移动端支持

系统已优化移动端体验：
- 响应式设计，自适应各种屏幕
- 触摸友好的操作界面
- 支持横屏和竖屏模式

## 🛠️ 故障排除

### 同步失败

**原因1**: Token无效或过期
- 解决: 重新生成Token并配置

**原因2**: Gist ID不存在
- 解决: 清空Gist ID，让系统自动创建新的

**原因3**: 网络问题
- 解决: 检查网络连接，稍后重试

### 无法登录

**原因1**: 忘记密码
- 解决: 
  1. 打开浏览器开发者工具 (F12)
  2. 在Console中执行: 
     ```javascript
     localStorage.removeItem('users');
     localStorage.removeItem('systemInitialized');
     location.reload();
     ```
  3. 刷新页面，重新进行初始化设置

**原因2**: 首次使用未完成设置
- 解决: 点击登录界面的"立即设置"按钮完成初始化

### 数据丢失

**预防措施**:
1. 定期点击"同步数据"备份到GitHub
2. 定期"导出Excel"作为本地备份
3. GitHub Gist有版本历史，可回退到之前的版本

**恢复数据**:
1. 访问 https://gist.github.com/
2. 找到对应的Gist
3. 查看历史版本并恢复

## 🌟 高级用法

### 批量导入

1. 准备Excel文件，包含必要列（姓名、身份证号、电话等）
2. 在对应页面点击"批量导入"
3. 选择Excel文件上传
4. 系统自动匹配列名并导入

### 数据导出

- **人员列表**: 导出所有在住人员信息
- **退宿人员**: 导出已退宿人员记录
- **房间配置**: 导出房间和床位信息

### 统计分析

- 实时统计人数、床位占用率
- 按楼栋分类统计
- 可视化床位余量

## 📞 技术支持

如有问题，请检查：
1. 浏览器控制台的错误信息
2. GitHub Token权限是否正确
3. 网络连接是否正常

## 🔄 版本更新

当需要更新系统时：
1. 备份现有数据（同步到GitHub）
2. 替换 `index.html` 文件
3. 刷新页面
4. 数据会自动从GitHub恢复

## 📄 许可

本系统基于MIT许可开源使用。

---

## ⚠️ 重要安全提醒

1. **首次使用必须设置密码** - 系统会强制要求设置，确保不使用默认密码
2. **定期修改密码** - 建议每3-6个月修改一次密码
3. **保管好GitHub Token** - Token具有访问您GitHub数据的权限
4. **定期备份数据** - 使用"同步数据"和"导出Excel"双重备份
5. **不要在公共电脑使用** - 避免在网吧等公共场所登录

---

**版本**: v2.0 (增强安全版)  
**更新日期**: 2025年1月

